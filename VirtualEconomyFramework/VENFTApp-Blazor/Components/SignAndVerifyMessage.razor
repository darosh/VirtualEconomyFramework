@inject AppData AppData

<div class="card d-flex justify-content-center align-items-center" style="margin-top:10px;">
    <div class="card-header w-100" style="padding-top: 5px;padding-bottom: 5px;">
        <h5 class="text-center w-100">Message signatures</h5>
    </div>
    <div class="card-body d-flex justify-content-center align-items-center" style="padding: 5px;padding-left: 20px;padding-right: 20px;padding-bottom: 10px; min-height:500px; height:500px; max-width:350px;">
        <Spin Tip="Processing..." Spinning="@processing">
            <div class="row d-flex justify-content-center align-items-center w-100">
                <div class="col w-auto">
                    <div class="row">
                        <div class="col d-flex justify-content-center align-items-center">
                            <h6>Sign Message</h6>
                        </div>
                    </div>
                    <div class="row" style="margin-top:10px;">
                        <div class="col">
                            <Input Placeholder="Add message" @bind-Value=@message Style="font-size:12px;" />
                        </div>
                    </div>
                    <div class="row" style="margin-top:10px;">
                        <div class="col d-flex justify-content-center align-items-center">
                            <button class="btn btn-primary" @onclick="SignMessage">Sign Message</button>
                        </div>
                    </div>
                    <div class="row" style="margin-top:10px;">
                        <div class="col d-flex justify-content-center align-items-center">
                            <small>Result</small>
                        </div>
                    </div>
                    <div class="row" style="margin-top:2px;">
                        <div class="col d-flex justify-content-center align-items-center">
                            <textarea style="min-width:250px; min-height:80px;">@signature</textarea>
                        </div>
                    </div>
                    <div class="row" style="margin-top:20px;">
                        <div class="col d-flex justify-content-center align-items-center">
                            <h6>Verify Message Signature</h6>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col d-flex justify-content-center align-items-center">
                            <Input Placeholder="Add message" @bind-Value=@verifyMessage Style="font-size:12px;" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col d-flex justify-content-center align-items-center">
                            <Input Placeholder="Add message signature" @bind-Value=@verifyMessageSignature Style="font-size:12px;" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col d-flex justify-content-center align-items-center">
                            <Input Placeholder="Add address" @bind-Value=@verifyMessageAddress Style="font-size:12px;" />
                        </div>
                    </div>
                    <div class="row" style="margin-top:10px;">
                        <div class="col d-flex justify-content-center align-items-center">
                            <button class="btn btn-primary" @onclick="VerifyMessageSignature">Verify Signature</button>
                        </div>
                    </div>
                    <div class="row" style="margin-top:10px;">
                        <div class="col d-flex justify-content-center align-items-center">
                            <span>Verification Result: @verifyResult</span>
                        </div>
                    </div>
                </div>
            </div>
        </Spin>
    </div>
</div>

@code {
    bool processing = false;
    string verifyMessageAddress = string.Empty;
    string verifyMessageSignature = string.Empty;
    string verifyResult = string.Empty;
    string verifyMessage = string.Empty;
    string message = string.Empty;
    string signature = string.Empty;

    private async Task SignMessage(MouseEventArgs e)
    {
        processing = true;
        StateHasChanged();
        await Task.Delay(50);
        var res = await AppData.Account.SignMessage(message);
        signature = res.Item2;
        processing = false;
        StateHasChanged();
    }

    private async Task VerifyMessageSignature(MouseEventArgs e)
    {
        processing = true;
        StateHasChanged();
        await Task.Delay(50);
        var res = await AppData.Account.VerifyMessage(verifyMessage, verifyMessageSignature, verifyMessageAddress);
        verifyResult = res.Item2;
        processing = false;
        StateHasChanged();
    }
}
